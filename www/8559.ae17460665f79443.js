"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8559],{8559:(k,g,r)=>{r.r(g),r.d(g,{PlansPageModule:()=>v});var d=r(6895),f=r(433),o=r(8058),l=r(1407),m=r(655),c=r(4573),p=r(529),t=r(8274),P=r(8243);function b(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-item",12),t.NdJ("click",function(){const u=t.CHM(e).$implicit,h=t.oxw();return t.KtG(h.purchase(u))}),t.TgZ(1,"ion-label",13)(2,"h2"),t._uU(3),t.qZA(),t.TgZ(4,"p"),t._uU(5),t.qZA()(),t.TgZ(6,"ion-button",14),t._uU(7),t.qZA()()}if(2&n){const e=a.$implicit;t.xp6(3),t.Oqu(e.title),t.xp6(2),t.Oqu(e.description),t.xp6(2),t.AsE(" ",e.price," ",e.currency," ")}}const x=[{path:"",component:(()=>{class n{constructor(e,i,s,u,h,y,O,M,w,_){this.navCtrl=e,this.activateRoute=i,this.router=s,this.http=u,this.plt=h,this.toastCtrl=y,this.loadingCtrl=O,this.store=M,this.ref=w,this.alertCtrl=_,this.plans=[],this.tempLetsID=this.activateRoute.snapshot.paramMap.get("tempLetsID"),this.plt.ready().then(()=>{this.registerProducts(),this.store.ready(()=>{this.plans=this.store.products,(""===this.plans[this.plans.length-1].price||null===this.plans[this.plans.length-1].price)&&this.plans.splice(-1),this.ref.detectChanges()})})}ionViewDidLoad(){}registerProducts(){if(this.store.products.length>0)return;let e=this.loadingCtrl.create({message:"Please wait..."});e.then(i=>{i.present()}),this.http.post(c.L.baseURL+"/services/getSubscriptionPlans",{client_key:c.L.client_key,user_id:localStorage.getItem("il_user_id"),plan_type:1},{headers:(new p.WM).set("content-type","application/x-www-form-urlencoded")}).subscribe(i=>{if(e.then(s=>{s.dismiss()}),this.resultObj=i,200==this.resultObj.code){for(let s=0;s<this.resultObj.plans.length;s++)this.store.register({id:this.resultObj.plans[s].apple_product_key,type:this.store.CONSUMABLE});this.store.refresh(),this.setupListeners()}},i=>{e.then(s=>{s.dismiss()})})}setupListeners(){this.store.when("product").approved(e=>(this.http.post(c.L.baseURL+"/services/saveIOSSubscription",{client_key:c.L.client_key,user_id:localStorage.getItem("il_user_id"),p_id:e.id,transaction_id:e.transaction.id,transaction_device:2},{headers:(new p.WM).set("content-type","application/x-www-form-urlencoded")}).subscribe(i=>{this.resultObj=i,200==this.resultObj.code?(this.toastCtrl.create({message:"Subscribed successfully.",duration:3e3,position:"top",cssClass:"custom-success-class"}).then(s=>{s.present()}),this.navCtrl.navigateForward(this.tempLetsID>0?"/home/"+this.tempLetsID:"/my-subscription")):this.toastCtrl.create({message:"Something went wrong. Please try again..",duration:3e3,position:"top",cssClass:"custom-failure-class"}).then(s=>{s.present()})},i=>{this.toastCtrl.create({message:"Something went wrong. Please try again..",duration:3e3,position:"top",cssClass:"custom-failure-class"}).then(s=>{s.present()})}),e.verify())).verified(e=>e.finish())}purchase(e){this.store.order(e).then(i=>{this.ref.detectChanges()},i=>{this.presentAlert("Failed","Purchase failed, try again later: ${e}")})}restore(){this.store.refresh()}presentAlert(e,i){return(0,m.mG)(this,void 0,void 0,function*(){yield(yield this.alertCtrl.create({header:e,subHeader:"",message:i,buttons:["OK"]})).present()})}backToSubscription(){this.navCtrl.navigateBack("/my-subscription")}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(o.SH),t.Y36(l.gz),t.Y36(l.F0),t.Y36(p.eN),t.Y36(o.t4),t.Y36(o.yF),t.Y36(o.HT),t.Y36(P.g),t.Y36(t.sBO),t.Y36(o.Br))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-plans"]],decls:15,vars:1,consts:[["collapse","fade"],[1,"transparent-navbar","white-text"],["slot","start"],[3,"click"],["name","arrow-back"],[1,"dark-bg","white-text","ion-padding"],[1,"full-content"],[1,"close-button",3,"click"],["name","close-circle"],[1,"subscription-holder"],[1,"subscription-top"],["button","","detail","false",3,"click",4,"ngFor","ngForOf"],["button","","detail","false",3,"click"],[1,"ion-text-wrap"],["slot","end",1,"subscription-buy"]],template:function(e,i){1&e&&(t.TgZ(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2)(3,"ion-button",3),t.NdJ("click",function(){return i.backToSubscription()}),t._UZ(4,"ion-icon",4),t.qZA()()()(),t.TgZ(5,"ion-content",5)(6,"div",6)(7,"div",7),t.NdJ("click",function(){return i.navCtrl.pop()}),t._UZ(8,"ion-icon",8),t.qZA()(),t.TgZ(9,"div",6)(10,"div",9)(11,"div",10),t._uU(12,"PLANS"),t.qZA(),t.TgZ(13,"ion-list"),t.YNc(14,b,8,4,"ion-item",11),t.qZA()()()()),2&e&&(t.xp6(14),t.Q6J("ngForOf",i.plans))},dependencies:[d.sg,o.YG,o.Sm,o.W2,o.Gu,o.gu,o.Ie,o.Q$,o.q_,o.sr],styles:[".subscription-holder[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-top:20px}.subscription-top[_ngcontent-%COMP%]{display:flex;width:100%;height:150px;line-height:95px;justify-content:center;font-size:30px;font-weight:700;letter-spacing:3px;color:#fff;padding:30px 0;border-radius:10px 10px 0 0;background:url(plan-bg.b52630c56fd9c397.jpeg) no-repeat center center}ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px;font-weight:700;color:#fff;margin-bottom:10px}ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;color:#f4f4f4;margin-bottom:5px}.subscription-buy[_ngcontent-%COMP%]{background-color:#065efe!important;--background: #065efe;color:#fff;padding:8px 10px;height:30px;border-radius:5px}.close-button[_ngcontent-%COMP%]{float:right;height:25px;width:25px;margin-bottom:15px;font-size:25px}.close-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#fff}.condition-text[_ngcontent-%COMP%], .help-text[_ngcontent-%COMP%]{font-size:13px;color:#777;text-align:right;margin-top:15px}.help-text[_ngcontent-%COMP%]{margin-top:50px;text-align:center;color:#a5a2a2}.scroll-content[_ngcontent-%COMP%]{background-color:rgba(0,0,0,.8)}"]}),n})()}];let C=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[l.Bz.forChild(x),l.Bz]}),n})(),v=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[d.ez,f.u5,o.Pc,C]}),n})()}}]);